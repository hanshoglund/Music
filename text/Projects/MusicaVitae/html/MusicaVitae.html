<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="author" content="Hans Höglund 2012" />
  <title>Passager, for string orchestra</title>
  <style type="text/css">
/*<![CDATA[*/
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode, table.sourceCode pre 
   { margin: 0; padding: 0; border: 0; vertical-align: baseline; border: none; }
td.lineNumbers { border-right: 1px solid #AAAAAA; text-align: right; color: #AAAAAA; padding-right: 5px; padding-left: 5px; }
td.sourceCode { padding-left: 5px; }
code.sourceCode span.kw { color: #007020; font-weight: bold; } 
code.sourceCode span.dt { color: #902000; }
code.sourceCode span.dv { color: #40a070; }
code.sourceCode span.bn { color: #40a070; }
code.sourceCode span.fl { color: #40a070; }
code.sourceCode span.ch { color: #4070a0; }
code.sourceCode span.st { color: #4070a0; }
code.sourceCode span.co { color: #60a0b0; font-style: italic; }
code.sourceCode span.ot { color: #007020; }
code.sourceCode span.al { color: red; font-weight: bold; }
code.sourceCode span.fu { color: #06287e; }
code.sourceCode span.re { }
code.sourceCode span.er { color: red; font-weight: bold; }
/*]]>*/
  </style>
</head>
<body>
<div id="header">
<h1 class="title">Passager, for string orchestra</h1>
<h3 class="author">Hans Höglund 2012</h3>
</div>
<div id="TOC">
<ul>
<li><a href="#introduction">Introduction</a></li>
<li><a href="#preliminaries">Preliminaries</a><ul>
<li><a href="#instruments-and-parts">Instruments and parts</a></li>
<li><a href="#time-and-pitch">Time and pitch</a></li>
<li><a href="#dynamics">Dynamics</a></li>
<li><a href="#articulation">Articulation</a></li>
<li><a href="#playing-techniques">Playing techniques</a></li>
<li><a href="#intonation">Intonation</a></li>
<li><a href="#cues">Cues</a></li>
</ul></li>
<li><a href="#midi-rendering">Midi rendering</a><ul>
<li><a href="#channel">Channel</a></li>
<li><a href="#instrument">Instrument</a></li>
<li><a href="#pitch-and-bending">Pitch and bending</a></li>
<li><a href="#left-hand">Left hand</a></li>
<li><a href="#right-hand">Right hand</a></li>
<li><a href="#cues-1">Cues</a></li>
</ul></li>
<li><a href="#high-level-constructors">High-level constructors</a><ul>
<li><a href="#open-strings">Open Strings</a></li>
<li><a href="#natural-harmonics">Natural harmonics</a></li>
<li><a href="#quarter-stopped-strings">Quarter stopped strings</a></li>
<li><a href="#stopped-strings">Stopped strings</a></li>
<li><a href="#tremolo">Tremolo</a></li>
</ul></li>
<li><a href="#final-composition">Final composition</a><ul>
<li><a href="#pitches">Pitches</a></li>
<li><a href="#melody">Melody</a></li>
<li><a href="#harmony">Harmony</a></li>
<li><a href="#sections">Sections</a></li>
<li><a href="#test">Test</a></li>
</ul></li>
</ul>
</div>
<h1 id="introduction"><a href="#TOC">Introduction</a></h1>
<p>This document describes a piece for string orchestra. It is a literate program, which may be read as well as executed.</p>
<p>To convert into a readable Pdf file, install Pandoc and use</p>
<pre><code>markdown2pdf -o MusicaVitae.pdf MusicaVitae.lhs
</code></pre>
<p>To run the program, install the Haskell platform and the <code>Music.Time</code> module. For correct playback of intonation, use a sampler that support Midi Tuning Standard, such as <a href="http://timidity.sourceforge.net/">Timidity</a>.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><br /><span class="co">{-# LANGUAGE</span><br /><span class="co">    TypeSynonymInstances,</span><br /><span class="co">    FlexibleInstances,</span><br /><span class="co">    MultiParamTypeClasses,</span><br /><span class="co">    DeriveFunctor #-}</span><br /><br /><span class="kw">module</span> <span class="dt">Music.Projects.MusicaVitae</span><br />(<br /><span class="co">-- * Preliminaries</span><br /><span class="co">-- ** Instruments and tuning</span><br />    <span class="dt">Part</span>(<span class="fu">..</span>),<br />    <span class="dt">Section</span>(<span class="fu">..</span>),<br />    <span class="dt">Tuning</span>(<span class="fu">..</span>),<br />    partSection,<br />    sectionTuning,<br />    partTuning,<br />    ensemble,<br />    sectionParts,<br />    isViolin, isViola, isCello,<br />    highParts, lowParts,<br />    highViolinParts, highViolaParts, highCelloParts,<br />    lowViolinParts, lowViolaParts, lowCelloParts,<br />    doubleBass,<br />    <span class="dt">Doubling</span>(<span class="fu">..</span>),<br />    <span class="dt">PartFunctor</span>(<span class="fu">..</span>),<br /><br /><span class="co">-- ** Time and pitch</span><br />    <span class="dt">Dur</span>(<span class="fu">..</span>),<br />    <span class="dt">Pitch</span>(<span class="fu">..</span>),<br />    <span class="dt">Str</span>(<span class="fu">..</span>),<br />    <span class="dt">Scale</span>(<span class="fu">..</span>),<br />    step,<br />    scaleFromSteps,<br />    <span class="dt">PitchFunctor</span>(<span class="fu">..</span>),<br /><br /><span class="co">-- ** Dynamics</span><br />    <span class="dt">Level</span>(<span class="fu">..</span>),<br />    <span class="dt">Dynamics</span>(<span class="fu">..</span>),<br />    levelAt,<br />    ppp, pp, p, mf, f, ff, fff,<br />    cresc,<br />    dim,<br />    <span class="dt">LevelFunctor</span>(<span class="fu">..</span>),<br /><br /><span class="co">-- ** Articulation</span><br />    <span class="dt">Articulation</span>(<span class="fu">..</span>),<br />    <span class="dt">Phrasing</span>(<span class="fu">..</span>),<br />    staccato,<br />    tenuto,<br />    legato,<br />    portato,<br /><br /><span class="co">-- ** Playing techniques</span><br />    <span class="dt">RightHand</span>(<span class="fu">..</span>),<br />    <span class="dt">LeftHand</span>(<span class="fu">..</span>),<br />    <span class="dt">Stopping</span>(<span class="fu">..</span>),<br />    <span class="dt">Stopped</span>,<br />    <span class="dt">Technique</span>,<br /><br /><span class="co">-- ** Intonation</span><br />    <span class="dt">Intonation</span>(<span class="fu">..</span>),<br />    intonation,<br />    cueIntonation,<br />    raisedIntonation,<br /><br /><span class="co">-- ** Cues</span><br />    <span class="dt">Cue</span>(<span class="fu">..</span>),<br /><br /><span class="co">-- * Midi rendering</span><br />    renderCue,<br /><br /><span class="co">-- * High-level constructors</span><br /><span class="co">-- ** Open strings</span><br />    openString,<br />    openStringPizz,<br />    openStringJete,<br />    openStrings,<br /><br /><span class="co">-- ** Natural harmonics</span><br />    naturalHarmonic,<br />    naturalHarmonicPizz,<br />    naturalHarmonicJete,<br />    naturalHarmonics,<br /><br /><span class="co">-- ** Quarter stopped strings</span><br />    quarterStoppedString,<br />    quarterStoppedStrings,<br /><br /><span class="co">-- ** Stopped strings</span><br />    stoppedString,<br />    stoppedStringPizz,<br />    stoppedStringJete,<br />    stoppedStrings,<br /><br /><span class="co">-- ** Tremolo</span><br />    stoppedStringTrem,<br />    naturalHarmonicTrem,<br />)<br /><span class="kw">where</span><br /><br /><span class="kw">import</span> <span class="dt">Prelude</span> <span class="kw">hiding</span> ( <span class="fu">reverse</span> )<br /><br /><span class="kw">import</span> <span class="dt">Control.Applicative</span><br /><span class="kw">import</span> <span class="dt">Data.Convert</span> ( convert )<br /><span class="kw">import</span> <span class="kw">qualified</span> <span class="dt">Data.List</span> <span class="kw">as</span> <span class="dt">List</span><br /><br /><span class="kw">import</span> <span class="dt">Music</span><br /><span class="kw">import</span> <span class="dt">Music.Time.Overlay</span><br /><span class="kw">import</span> <span class="dt">Music.Time.Tremolo</span><br /><span class="kw">import</span> <span class="dt">Music.Time.Functors</span><br /><span class="kw">import</span> <span class="dt">Music.Render</span><br /><span class="kw">import</span> <span class="dt">Music.Render.Midi</span><br /><span class="kw">import</span> <span class="dt">Music.Inspect</span><br /><span class="kw">import</span> <span class="dt">Music.Util.List</span><br /><span class="kw">import</span> <span class="dt">Music.Util.Either</span></code></pre>
<p></p>
<h1 id="preliminaries"><a href="#TOC">Preliminaries</a></h1>
<p>In this chapter we will describe the musical preliminaries needed to compose the piece.</p>
<h2 id="instruments-and-parts"><a href="#TOC">Instruments and parts</a></h2>
<p>The instrumentation is as follows:</p>
<ul>
<li>Violin I-IV</li>
<li>Viola I-II</li>
<li>Cello I-II</li>
<li>Double Bass</li>
</ul>
<p>A basic idea of the piece is to combine (slightly) different tunings of the instruments using open-string techniques and harmonics. For this purpose, we will split the ensemble into three sections, each using a different tuning:</p>
<ul>
<li>Odd-numbered Vl, Vla and Vc parts tunes A4 to 443 Hz (A3 to 221.5 Hz)</li>
<li>Even-numbered Vl, Vla and Vc parts tunes A4 to 437 Hz (A3 to 218.5 Hz)</li>
<li>Double bass tunes A1 to 55 Hz</li>
</ul>
<p>The other strings should be tuned in relation to the A-string as usual.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Part</span><br />    <span class="fu">=</span> <span class="dt">Violin</span> <span class="dt">Int</span><br />    <span class="fu">|</span> <span class="dt">Viola</span>  <span class="dt">Int</span><br />    <span class="fu">|</span> <span class="dt">Cello</span>  <span class="dt">Int</span><br />    <span class="fu">|</span> <span class="dt">DoubleBass</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="kw">data</span> <span class="dt">Section</span><br />    <span class="fu">=</span> <span class="dt">High</span> <span class="fu">|</span> <span class="dt">Low</span> <span class="fu">|</span> <span class="dt">Middle</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span>, <span class="kw">Enum</span>, <span class="kw">Bounded</span> )<br /><br /><span class="kw">type</span> <span class="dt">Tuning</span> <span class="fu">=</span> <span class="dt">Frequency</span></code></pre>
<p>We now define the relation between these types as follows:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">partSection   </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">Section</span><br /><span class="ot">sectionTuning </span><span class="ot">::</span> <span class="dt">Section</span> <span class="ot">-&gt;</span> <span class="dt">Tuning</span><br /><span class="ot">partTuning    </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">Tuning</span><br /><br />partSection ( <span class="dt">Violin</span> <span class="dv">1</span> ) <span class="fu">=</span> <span class="dt">High</span><br />partSection ( <span class="dt">Violin</span> <span class="dv">2</span> ) <span class="fu">=</span> <span class="dt">Low</span><br />partSection ( <span class="dt">Violin</span> <span class="dv">3</span> ) <span class="fu">=</span> <span class="dt">High</span><br />partSection ( <span class="dt">Violin</span> <span class="dv">4</span> ) <span class="fu">=</span> <span class="dt">Low</span><br />partSection ( <span class="dt">Viola</span> <span class="dv">1</span> )  <span class="fu">=</span> <span class="dt">High</span><br />partSection ( <span class="dt">Viola</span> <span class="dv">2</span> )  <span class="fu">=</span> <span class="dt">Low</span><br />partSection ( <span class="dt">Cello</span> <span class="dv">1</span> )  <span class="fu">=</span> <span class="dt">High</span><br />partSection ( <span class="dt">Cello</span> <span class="dv">2</span> )  <span class="fu">=</span> <span class="dt">Low</span><br />partSection <span class="dt">DoubleBass</span> <span class="fu">=</span> <span class="dt">Middle</span><br /><br />sectionTuning <span class="dt">Low</span>    <span class="fu">=</span> <span class="dv">440</span> <span class="fu">-</span> <span class="dv">2</span><br />sectionTuning <span class="dt">Middle</span> <span class="fu">=</span> <span class="dv">440</span><br />sectionTuning <span class="dt">High</span>   <span class="fu">=</span> <span class="dv">440</span> <span class="fu">+</span> <span class="dv">2</span><br /><br />partTuning <span class="fu">=</span> sectionTuning <span class="fu">.</span> partSection</code></pre>
<p>Then add some utility definitions to quickly access the various parts:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">ensemble     </span><span class="ot">::</span> [<span class="dt">Part</span>]<br /><span class="ot">sectionParts </span><span class="ot">::</span> <span class="dt">Section</span> <span class="ot">-&gt;</span> [<span class="dt">Part</span>]<br /><br />isViolin, isViola, isCello,<span class="ot"> isDoubleBass </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">Bool</span><br /><br />highParts, lowParts<br /><span class="ot">    </span><span class="ot">::</span> [<span class="dt">Part</span>]<br />highViolinParts, highViolaParts, highCelloParts<br /><span class="ot">    </span><span class="ot">::</span> [<span class="dt">Part</span>]<br />lowViolinParts, lowViolaParts, lowCelloParts<br /><span class="ot">    </span><span class="ot">::</span> [<span class="dt">Part</span>]<br /><span class="ot">doubleBass </span><span class="ot">::</span> <span class="dt">Part</span><br /><br />ensemble<br />    <span class="fu">=</span> [ <span class="dt">Violin</span> <span class="dv">1</span>, <span class="dt">Violin</span> <span class="dv">2</span>, <span class="dt">Violin</span> <span class="dv">3</span>, <span class="dt">Violin</span> <span class="dv">4</span><br />      , <span class="dt">Viola</span> <span class="dv">1</span>, <span class="dt">Viola</span> <span class="dv">2</span>, <span class="dt">Cello</span> <span class="dv">1</span>, <span class="dt">Cello</span> <span class="dv">2</span>, <span class="dt">DoubleBass</span> ]<br /><br />sectionParts s  <span class="fu">=</span>  <span class="fu">filter</span> (\x <span class="ot">-&gt;</span> partSection x <span class="fu">==</span> s) ensemble<br /><br />highParts  <span class="fu">=</span>  sectionParts <span class="dt">High</span><br />lowParts   <span class="fu">=</span>  sectionParts <span class="dt">High</span><br /><br />isViolin     ( <span class="dt">Violin</span> _ )    <span class="fu">=</span>  <span class="kw">True</span><br />isViolin     _               <span class="fu">=</span>  <span class="kw">False</span><br />isViola      ( <span class="dt">Viola</span> _ )     <span class="fu">=</span>  <span class="kw">True</span><br />isViola      _               <span class="fu">=</span>  <span class="kw">False</span><br />isCello      ( <span class="dt">Cello</span> _ )     <span class="fu">=</span>  <span class="kw">True</span><br />isCello      _               <span class="fu">=</span>  <span class="kw">False</span><br />isDoubleBass ( <span class="dt">DoubleBass</span> )  <span class="fu">=</span>  <span class="kw">True</span><br />isDoubleBass _               <span class="fu">=</span>  <span class="kw">True</span><br /><br />highViolinParts  <span class="fu">=</span>  <span class="fu">filter</span> isViolin (sectionParts <span class="dt">High</span>)<br />highViolaParts   <span class="fu">=</span>  <span class="fu">filter</span> isViola  (sectionParts <span class="dt">High</span>)<br />highCelloParts   <span class="fu">=</span>  <span class="fu">filter</span> isCello  (sectionParts <span class="dt">High</span>)<br />lowViolinParts   <span class="fu">=</span>  <span class="fu">filter</span> isViolin (sectionParts <span class="dt">Low</span>)<br />lowViolaParts    <span class="fu">=</span>  <span class="fu">filter</span> isViola  (sectionParts <span class="dt">Low</span>)<br />lowCelloParts    <span class="fu">=</span>  <span class="fu">filter</span> isCello  (sectionParts <span class="dt">Low</span>)<br />doubleBass       <span class="fu">=</span>  <span class="dt">DoubleBass</span></code></pre>
<p>All parts may be doubled. If several parts are doubled but not all, the musicians should strive for a balance between the two main tuning sections (i.e. avoid doubling just the upper parts or vice versa).</p>
<p>Certain cues are required to be played by a single musician even if the parts are doubled, which will be marked <em>solo</em>. These passages should be distributed evenly among the musicians, instead of being played by designated soloists.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Doubling</span> <span class="fu">=</span> <span class="dt">Solo</span> <span class="fu">|</span> <span class="dt">Tutti</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )</code></pre>
<p>The <code>PartFunctor</code> class defined useful operations for mapping over part and doubling.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">class</span> <span class="dt">PartFunctor</span> f <span class="kw">where</span><br /><span class="ot">    setPart     </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br /><span class="ot">    mapPart     </span><span class="ot">::</span> (<span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">Part</span>) <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br /><br /><span class="ot">    setDoubling </span><span class="ot">::</span> <span class="dt">Doubling</span> <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br /><span class="ot">    mapDoubling </span><span class="ot">::</span> (<span class="dt">Doubling</span> <span class="ot">-&gt;</span> <span class="dt">Doubling</span>) <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br /><br />    setPart     x <span class="fu">=</span> mapPart (<span class="fu">const</span> x)<br />    setDoubling x <span class="fu">=</span> mapDoubling (<span class="fu">const</span> x)</code></pre>
<h2 id="time-and-pitch"><a href="#TOC">Time and pitch</a></h2>
<p>We will use the temporal operations form <code>Music.Time</code> for composition on both event level and structural level. We use floating point values to represent durations.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">Dur</span> <span class="fu">=</span> <span class="dt">Double</span></code></pre>
<p>For simplicity, we will use Midi numbers for written pitch. Sounding pitch will of course be rendered depending on tuning and playing technique of the given part.</p>
<p>String number will be represented separately using a different type (named <code>Str</code> so as not to collide with <code>String</code>).</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">Pitch</span> <span class="fu">=</span> <span class="dt">Int</span><br /><br /><span class="kw">data</span> <span class="dt">Str</span> <span class="fu">=</span> <span class="dt">I</span> <span class="fu">|</span> <span class="dt">II</span> <span class="fu">|</span> <span class="dt">III</span> <span class="fu">|</span> <span class="dt">IV</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span>, <span class="kw">Ord</span>, <span class="kw">Enum</span>, <span class="kw">Bounded</span> )</code></pre>
<p>A scale is conceptually a function from steps to pitches. This relation is captured by the <code>step</code> function, which maps steps to pitches. For example, <code>major 'step' 3</code> means the third step in the major scale.</p>
<p>The simplest way to generate a scale is to list its relative steps, i.e. <code>2,2,2,1,2</code> for the first five pitches in the major scale. This is captured by the function <code>scaleFromSteps</code>.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">newtype</span> <span class="dt">Scale</span> a <span class="fu">=</span> <span class="dt">Scale</span> {<span class="ot"> getScale </span><span class="ot">::</span> [a] }<br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span>, <span class="kw">Functor</span> )<br /><br /><span class="ot">step </span><span class="ot">::</span> <span class="dt">Scale</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span><br />step (<span class="dt">Scale</span> xs) p <span class="fu">=</span> xs <span class="fu">!!</span> (p <span class="ot">`mod`</span> <span class="fu">length</span> xs)<br /><br /><span class="ot">scaleFromSteps </span><span class="ot">::</span> [<span class="dt">Pitch</span>] <span class="ot">-&gt;</span> <span class="dt">Scale</span> <span class="dt">Pitch</span><br />scaleFromSteps <span class="fu">=</span> <span class="dt">Scale</span> <span class="fu">.</span> accum<br />    <span class="kw">where</span><br />        accum <span class="fu">=</span> <span class="fu">snd</span> <span class="fu">.</span> List.mapAccumL add <span class="dv">0</span><br />        add a x <span class="fu">=</span> (a <span class="fu">+</span> x, a <span class="fu">+</span> x)<br /><br /><span class="ot">retrograde </span><span class="ot">::</span> <span class="dt">Scale</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Scale</span> <span class="dt">Pitch</span><br />retrograde <span class="fu">=</span> <span class="dt">Scale</span> <span class="fu">.</span> List.reverse <span class="fu">.</span> getScale</code></pre>
<p>The <code>PitchFunctor</code> class defines a useful operation for mapping over pitch. This generalizes to scales and scores containing pitched elements.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">class</span> <span class="dt">PitchFunctor</span> f <span class="kw">where</span><br /><span class="ot">    setPitch </span><span class="ot">::</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br /><span class="ot">    mapPitch </span><span class="ot">::</span> (<span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span>) <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br />    setPitch x <span class="fu">=</span> mapPitch (<span class="fu">const</span> x)<br /><br /><span class="kw">instance</span> <span class="dt">PitchFunctor</span> (<span class="dt">Pitch</span>) <span class="kw">where</span><br />    mapPitch f x <span class="fu">=</span> f x<br /><br /><span class="kw">instance</span> <span class="dt">PitchFunctor</span> (<span class="dt">Scale</span> <span class="dt">Pitch</span>) <span class="kw">where</span><br />    mapPitch f <span class="fu">=</span> <span class="fu">fmap</span> f<br /><br /><span class="ot">invert </span><span class="ot">::</span> <span class="dt">PitchFunctor</span> f <span class="ot">=&gt;</span> f <span class="ot">-&gt;</span> f<br />invert <span class="fu">=</span> mapPitch <span class="fu">negate</span></code></pre>
<h2 id="dynamics"><a href="#TOC">Dynamics</a></h2>
<p>We use a linear representation for dynamic levels. Level 0 corresponds to some medium level dynamic, level 1 to extremely loud and level -1 to extremely soft. A dynamic is a function from time to level, generalizing crescendo, diminuendo and so on.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">Level</span> <span class="fu">=</span> <span class="dt">Double</span><br /><br /><span class="kw">newtype</span> <span class="dt">Dynamics</span> <span class="fu">=</span> <span class="dt">Dynamics</span> {<span class="ot"> getDynamics </span><span class="ot">::</span> <span class="dt">Dur</span> <span class="ot">-&gt;</span> <span class="dt">Level</span> }<br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span> )<br /><br /><span class="kw">instance</span> <span class="kw">Show</span> <span class="dt">Dynamics</span> <span class="kw">where</span><br />    <span class="fu">show</span> x <span class="fu">=</span> <span class="st">&quot;&quot;</span><br /><br /><span class="ot">levelAt </span><span class="ot">::</span> <span class="dt">Dynamics</span> <span class="ot">-&gt;</span> <span class="dt">Dur</span> <span class="ot">-&gt;</span> <span class="dt">Level</span><br />levelAt (<span class="dt">Dynamics</span> n) t <span class="fu">=</span> n t<br /><br />ppp, pp, p, mf, f, ff,<span class="ot"> fff </span><span class="ot">::</span> <span class="dt">Dynamics</span><br />ppp <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">$</span> <span class="fu">const</span> (<span class="fu">-</span><span class="dv">0</span><span class="fu">.</span><span class="dv">8</span>)<br />pp  <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">$</span> <span class="fu">const</span> (<span class="fu">-</span><span class="dv">0</span><span class="fu">.</span><span class="dv">6</span>)<br />p   <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">$</span> <span class="fu">const</span> (<span class="fu">-</span><span class="dv">0</span><span class="fu">.</span><span class="dv">3</span>)<br />mf  <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">$</span> <span class="fu">const</span> <span class="dv">0</span><br />f   <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">$</span> <span class="fu">const</span> <span class="dv">0</span><span class="fu">.</span><span class="dv">25</span><br />ff  <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">$</span> <span class="fu">const</span> <span class="dv">0</span><span class="fu">.</span><span class="dv">5</span><br />fff <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">$</span> <span class="fu">const</span> <span class="dv">0</span><span class="fu">.</span><span class="dv">7</span><br /><br />cresc,<span class="ot"> dim </span><span class="ot">::</span> <span class="dt">Dynamics</span><br />cresc <span class="fu">=</span> <span class="dt">Dynamics</span> <span class="fu">id</span><br />dim   <span class="fu">=</span> <span class="dt">Dynamics</span> (<span class="fu">succ</span> <span class="fu">.</span> <span class="fu">negate</span>)<br /><br /><span class="kw">instance</span> <span class="kw">Num</span> <span class="dt">Dynamics</span> <span class="kw">where</span><br />    (<span class="dt">Dynamics</span> x) <span class="fu">+</span> (<span class="dt">Dynamics</span> y)  <span class="fu">=</span>  <span class="dt">Dynamics</span> (\t <span class="ot">-&gt;</span> x t <span class="fu">+</span> y t)<br />    (<span class="dt">Dynamics</span> x) <span class="fu">*</span> (<span class="dt">Dynamics</span> y)  <span class="fu">=</span>  <span class="dt">Dynamics</span> (\t <span class="ot">-&gt;</span> x t <span class="fu">*</span> y t)<br />    <span class="fu">signum</span> (<span class="dt">Dynamics</span> x)          <span class="fu">=</span>  <span class="dt">Dynamics</span> (<span class="fu">signum</span> <span class="fu">.</span> x)<br />    <span class="fu">abs</span> (<span class="dt">Dynamics</span> x)             <span class="fu">=</span>  <span class="dt">Dynamics</span> (<span class="fu">abs</span> <span class="fu">.</span> x)<br />    <span class="fu">fromInteger</span> n                <span class="fu">=</span>  <span class="dt">Dynamics</span> (<span class="fu">const</span> <span class="fu">$</span> <span class="fu">fromInteger</span> n)<br /><br /><span class="kw">class</span> <span class="dt">LevelFunctor</span> f <span class="kw">where</span><br /><span class="ot">    setLevel </span><span class="ot">::</span> <span class="dt">Level</span> <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br /><span class="ot">    mapLevel </span><span class="ot">::</span> (<span class="dt">Level</span> <span class="ot">-&gt;</span> <span class="dt">Level</span>) <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br />    setLevel x <span class="fu">=</span> mapLevel (<span class="fu">const</span> x)<br /><br /><span class="ot">    setDynamics </span><span class="ot">::</span> <span class="dt">Dynamics</span> <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br /><span class="ot">    mapDynamics </span><span class="ot">::</span> (<span class="dt">Dur</span> <span class="ot">-&gt;</span> <span class="dt">Level</span> <span class="ot">-&gt;</span> <span class="dt">Level</span>) <span class="ot">-&gt;</span> f <span class="ot">-&gt;</span> f<br />    setDynamics n <span class="fu">=</span> mapDynamics (\t _ <span class="ot">-&gt;</span> n <span class="ot">`levelAt`</span> t)<br /><br /><span class="kw">instance</span> <span class="dt">LevelFunctor</span> <span class="dt">Dynamics</span> <span class="kw">where</span><br />    mapLevel f (<span class="dt">Dynamics</span> n) <span class="fu">=</span> <span class="dt">Dynamics</span> (f <span class="fu">.</span> n)<br />    mapDynamics f (<span class="dt">Dynamics</span> n) <span class="fu">=</span> <span class="dt">Dynamics</span> (\t <span class="ot">-&gt;</span> f t <span class="fu">$</span> n t)</code></pre>
<h2 id="articulation"><a href="#TOC">Articulation</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Articulation</span><br />    <span class="fu">=</span> <span class="dt">Straight</span><br />    <span class="fu">|</span> <span class="dt">Accent</span>   <span class="dt">Double</span> <span class="dt">Articulation</span><br />    <span class="fu">|</span> <span class="dt">Duration</span> <span class="dt">Double</span> <span class="dt">Articulation</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="kw">data</span> <span class="dt">Phrasing</span><br />    <span class="fu">=</span> <span class="dt">Phrasing</span><br />    <span class="fu">|</span> <span class="dt">Binding</span> <span class="dt">Double</span> <span class="dt">Phrasing</span><br />    <span class="fu">|</span> <span class="dt">Begin</span> <span class="dt">Articulation</span> <span class="dt">Phrasing</span><br />    <span class="fu">|</span> <span class="dt">End</span> <span class="dt">Articulation</span> <span class="dt">Phrasing</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="ot">staccato </span><span class="ot">::</span> <span class="dt">Articulation</span> <span class="ot">-&gt;</span> <span class="dt">Articulation</span><br />staccato <span class="fu">=</span> <span class="dt">Duration</span> <span class="dv">0</span><span class="fu">.</span><span class="dv">8</span><br /><br /><span class="ot">tenuto </span><span class="ot">::</span> <span class="dt">Articulation</span> <span class="ot">-&gt;</span> <span class="dt">Articulation</span><br />tenuto <span class="fu">=</span> <span class="dt">Duration</span> <span class="dv">1</span><span class="fu">.</span><span class="dv">2</span><br /><br /><span class="ot">legato </span><span class="ot">::</span> <span class="dt">Phrasing</span> <span class="ot">-&gt;</span> <span class="dt">Phrasing</span><br />legato <span class="fu">=</span> <span class="dt">Binding</span> <span class="dv">1</span><span class="fu">.</span><span class="dv">2</span><br /><br /><span class="ot">portato </span><span class="ot">::</span> <span class="dt">Phrasing</span> <span class="ot">-&gt;</span> <span class="dt">Phrasing</span><br />portato <span class="fu">=</span> <span class="dt">Binding</span> <span class="dv">0</span><span class="fu">.</span><span class="dv">8</span></code></pre>
<h2 id="playing-techniques"><a href="#TOC">Playing techniques</a></h2>
<p>The piece makes use of different playing techniques in both hands.</p>
<p>The <code>RightHand</code> type is parameterized over time, articulation, phrasing and content. The <code>LeftHand</code> type is parameterized over pitch and string.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">RightHand</span> t c r a<br />    <span class="fu">=</span> <span class="dt">Pizz</span>   c a<br />    <span class="fu">|</span> <span class="dt">Single</span> c a<br />    <span class="fu">|</span> <span class="dt">Phrase</span> r [(t, a)]<br />    <span class="fu">|</span> <span class="dt">Jete</span>   r [a]<br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="kw">data</span> <span class="dt">LeftHand</span> p s<br />    <span class="fu">=</span> <span class="dt">OpenString</span>            s<br />    <span class="fu">|</span> <span class="dt">NaturalHarmonic</span>       p s<br />    <span class="fu">|</span> <span class="dt">NaturalHarmonicTrem</span>   p p s<br />    <span class="fu">|</span> <span class="dt">NaturalHarmonicGliss</span>  p p s<br />    <span class="fu">|</span> <span class="dt">QuarterStoppedString</span>  s<br />    <span class="fu">|</span> <span class="dt">StoppedString</span>         p s<br />    <span class="fu">|</span> <span class="dt">StoppedStringTrem</span>     p p s<br />    <span class="fu">|</span> <span class="dt">StoppedStringGliss</span>    p p s<br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="ot">leftHand </span><span class="ot">::</span> <span class="dt">RightHand</span> t c r a <span class="ot">-&gt;</span> [a]<br />leftHand (<span class="dt">Pizz</span>   c x)   <span class="fu">=</span>  [x]<br />leftHand (<span class="dt">Single</span> c x)   <span class="fu">=</span>  [x]<br />leftHand (<span class="dt">Phrase</span> c xs)  <span class="fu">=</span>  <span class="fu">map</span> <span class="fu">snd</span> xs<br />leftHand (<span class="dt">Jete</span>   c xs)  <span class="fu">=</span>  xs</code></pre>
<p>As the intonation will be different between open and stopped strings, we define a function mapping each left-hand technique to a stopping. This stopping also distributes over right-hand techniques (for example, an the intonation of a natural harmonic is open, whether played <em>arco</em> or <em>pizz</em>).</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Stopping</span> <span class="fu">=</span> <span class="dt">Open</span> <span class="fu">|</span> <span class="dt">QuarterStopped</span> <span class="fu">|</span> <span class="dt">Stopped</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="kw">class</span> <span class="dt">Stopped</span> a <span class="kw">where</span><br /><span class="ot">    stopping </span><span class="ot">::</span> a <span class="ot">-&gt;</span> <span class="dt">Stopping</span><br /><br /><span class="kw">instance</span> <span class="dt">Stopped</span> (<span class="dt">LeftHand</span> p s) <span class="kw">where</span><br />    stopping ( <span class="dt">OpenString</span>           s     ) <span class="fu">=</span> <span class="dt">Open</span><br />    stopping ( <span class="dt">NaturalHarmonic</span>      x s   ) <span class="fu">=</span> <span class="dt">Open</span><br />    stopping ( <span class="dt">NaturalHarmonicTrem</span>  x y s ) <span class="fu">=</span> <span class="dt">Open</span><br />    stopping ( <span class="dt">NaturalHarmonicGliss</span> x y s ) <span class="fu">=</span> <span class="dt">Open</span><br />    stopping ( <span class="dt">QuarterStoppedString</span> s     ) <span class="fu">=</span> <span class="dt">QuarterStopped</span><br />    stopping ( <span class="dt">StoppedString</span>        x s   ) <span class="fu">=</span> <span class="dt">Stopped</span><br />    stopping ( <span class="dt">StoppedStringTrem</span>    x y s ) <span class="fu">=</span> <span class="dt">Stopped</span><br />    stopping ( <span class="dt">StoppedStringGliss</span>   x y s ) <span class="fu">=</span> <span class="dt">Stopped</span><br /><br /><span class="kw">instance</span> <span class="dt">Stopped</span> a <span class="ot">=&gt;</span> <span class="dt">Stopped</span> (<span class="dt">RightHand</span> t r p a) <span class="kw">where</span><br />    stopping ( <span class="dt">Pizz</span>   c x )       <span class="fu">=</span>  stopping x<br />    stopping ( <span class="dt">Single</span> c x )       <span class="fu">=</span>  stopping x<br />    stopping ( <span class="dt">Phrase</span> r (x<span class="fu">:</span>xs) )  <span class="fu">=</span>  stopping (<span class="fu">snd</span> x)<br />    stopping ( <span class="dt">Jete</span>   r (x<span class="fu">:</span>xs) )  <span class="fu">=</span>  stopping x<br /><br /><span class="kw">instance</span> <span class="dt">PitchFunctor</span> (<span class="dt">LeftHand</span> <span class="dt">Pitch</span> s) <span class="kw">where</span><br />    mapPitch f ( <span class="dt">StoppedString</span>        x s   ) <span class="fu">=</span> <span class="dt">StoppedString</span>      (f x) s<br />    mapPitch f ( <span class="dt">StoppedStringTrem</span>    x y s ) <span class="fu">=</span> <span class="dt">StoppedStringTrem</span>  (f x) (f y) s<br />    mapPitch f ( <span class="dt">StoppedStringGliss</span>   x y s ) <span class="fu">=</span> <span class="dt">StoppedStringGliss</span> (f x) (f y) s<br />    mapPitch f x                              <span class="fu">=</span> x<br /><br /><span class="kw">instance</span> <span class="dt">PitchFunctor</span> a <span class="ot">=&gt;</span> <span class="dt">PitchFunctor</span> (<span class="dt">RightHand</span> t c r a) <span class="kw">where</span><br />    mapPitch f ( <span class="dt">Pizz</span>   c x )   <span class="fu">=</span>  <span class="dt">Pizz</span>   c (mapPitch f x)<br />    mapPitch f ( <span class="dt">Single</span> c x )   <span class="fu">=</span>  <span class="dt">Single</span> c (mapPitch f x)<br />    mapPitch f ( <span class="dt">Phrase</span> r xs )  <span class="fu">=</span>  <span class="dt">Phrase</span> r (<span class="fu">fmap</span> (\(d,p) <span class="ot">-&gt;</span> (d, mapPitch f p)) xs)<br />    mapPitch f ( <span class="dt">Jete</span>   r xs )  <span class="fu">=</span>  <span class="dt">Jete</span>   r (<span class="fu">fmap</span> (mapPitch f) xs)</code></pre>
<h2 id="intonation"><a href="#TOC">Intonation</a></h2>
<p>Many playing techiniques in the score calls for open strings. In this case intonation is determined solely by the tuning.</p>
<p>In some cases, open-string techniques are used with an above first-position stop. This should make the open string pitch rise about a quarter-tone step (or at least less than a half-tone step).</p>
<p>Where stopped strings are used, intonation is determined by context:</p>
<ul>
<li><p>In solo passages, intonation is individual. No attempt should be made to synchronize intontation (on long notes et al) for overlapping solo cues.</p></li>
<li><p>In unison passages, common intonation should be used.</p></li>
</ul>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">data</span> <span class="dt">Intonation</span><br />    <span class="fu">=</span> <span class="dt">Tuning</span><br />    <span class="fu">|</span> <span class="dt">Raised</span><br />    <span class="fu">|</span> <span class="dt">Common</span><br />    <span class="fu">|</span> <span class="dt">Individual</span><br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="ot">intonation </span><span class="ot">::</span> <span class="dt">Doubling</span> <span class="ot">-&gt;</span> <span class="dt">Technique</span> <span class="ot">-&gt;</span> <span class="dt">Intonation</span><br /><br />intonation <span class="dt">Tutti</span> t <span class="fu">=</span> <span class="kw">case</span> stopping t <span class="kw">of</span><br />    <span class="dt">Open</span>           <span class="ot">-&gt;</span> <span class="dt">Tuning</span><br />    <span class="dt">QuarterStopped</span> <span class="ot">-&gt;</span> <span class="dt">Raised</span><br />    <span class="dt">Stopped</span>        <span class="ot">-&gt;</span> <span class="dt">Common</span><br /><br />intonation <span class="dt">Solo</span> t <span class="fu">=</span> <span class="kw">case</span> stopping t <span class="kw">of</span><br />    <span class="dt">Open</span>           <span class="ot">-&gt;</span> <span class="dt">Tuning</span><br />    <span class="dt">QuarterStopped</span> <span class="ot">-&gt;</span> <span class="dt">Raised</span><br />    <span class="dt">Stopped</span>        <span class="ot">-&gt;</span> <span class="dt">Individual</span><br /><br /><span class="ot">cueIntonation </span><span class="ot">::</span> <span class="dt">Cue</span> <span class="ot">-&gt;</span> <span class="dt">Intonation</span><br />cueIntonation (<span class="dt">Cue</span> p d n t) <span class="fu">=</span> intonation d t<br /><br /><span class="ot">raisedIntonation </span><span class="ot">::</span> <span class="dt">Cent</span><br />raisedIntonation <span class="fu">=</span> <span class="dv">23</span> <span class="dt">Cent</span></code></pre>
<h2 id="cues"><a href="#TOC">Cues</a></h2>
<p>A <em>cue</em> is an action taken by a performer on time.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">Technique</span> <span class="fu">=</span><br />    <span class="dt">RightHand</span><br />        <span class="dt">Dur</span><br />        <span class="dt">Articulation</span><br />        <span class="dt">Phrasing</span><br />        (<span class="dt">LeftHand</span><br />            <span class="dt">Pitch</span> <span class="dt">Str</span>)<br /><br /><span class="kw">data</span> <span class="dt">Cue</span><br />    <span class="fu">=</span> <span class="dt">Cue</span><br />    {<br /><span class="ot">        cuePart      </span><span class="ot">::</span> <span class="dt">Part</span>,<br /><span class="ot">        cueDoubling  </span><span class="ot">::</span> <span class="dt">Doubling</span>,<br /><span class="ot">        cueDynamics  </span><span class="ot">::</span> <span class="dt">Dynamics</span>,  <span class="co">-- time is 0 to 1 for the duration of the cue</span><br /><span class="ot">        cueTechnique </span><span class="ot">::</span> <span class="dt">Technique</span><br />    }<br />    <span class="kw">deriving</span> ( <span class="kw">Eq</span>, <span class="kw">Show</span> )<br /><br /><span class="kw">instance</span> <span class="dt">PartFunctor</span> <span class="dt">Cue</span> <span class="kw">where</span><br />    mapPart     f (<span class="dt">Cue</span> p d n t) <span class="fu">=</span> <span class="dt">Cue</span> (f p) d n t<br />    mapDoubling f (<span class="dt">Cue</span> p d n t) <span class="fu">=</span> <span class="dt">Cue</span> p (f d) n t<br /><br /><span class="kw">instance</span> <span class="dt">PitchFunctor</span> <span class="dt">Cue</span> <span class="kw">where</span><br />    mapPitch f (<span class="dt">Cue</span> p d n t) <span class="fu">=</span> <span class="dt">Cue</span> p d n (mapPitch f t)<br /><br /><span class="kw">instance</span> <span class="dt">LevelFunctor</span> <span class="dt">Cue</span> <span class="kw">where</span><br />    mapLevel f    (<span class="dt">Cue</span> p d n t) <span class="fu">=</span> <span class="dt">Cue</span> p d (mapLevel f n) t<br />    mapDynamics f (<span class="dt">Cue</span> p d n t) <span class="fu">=</span> <span class="dt">Cue</span> p d (mapDynamics f n) t<br /><br /><span class="kw">instance</span> (<span class="dt">Time</span> t, <span class="dt">PartFunctor</span> a) <span class="ot">=&gt;</span> <span class="dt">PartFunctor</span> (<span class="dt">Score</span> t a) <span class="kw">where</span><br />    mapPart f <span class="fu">=</span> <span class="fu">fmap</span> (mapPart f)<br />    mapDoubling f <span class="fu">=</span> <span class="fu">fmap</span> (mapDoubling f)<br /><br /><span class="kw">instance</span> (<span class="dt">Time</span> t, <span class="dt">PitchFunctor</span> a) <span class="ot">=&gt;</span> <span class="dt">PitchFunctor</span> (<span class="dt">Score</span> t a) <span class="kw">where</span><br />    mapPitch f <span class="fu">=</span> <span class="fu">fmap</span> (mapPitch f)<br /><br /><span class="kw">instance</span> (<span class="dt">Time</span> t, <span class="dt">LevelFunctor</span> a) <span class="ot">=&gt;</span> <span class="dt">LevelFunctor</span> (<span class="dt">Score</span> t a) <span class="kw">where</span><br />    mapLevel    f <span class="fu">=</span> <span class="fu">fmap</span> (mapLevel f)<br />    mapDynamics f <span class="fu">=</span> <span class="fu">fmap</span> (mapDynamics f)</code></pre>
<p></p>
<h1 id="midi-rendering"><a href="#TOC">Midi rendering</a></h1>
<p>We are going to compose the piece as a score of cues. In order to hear the piece and make musical decisions, we need to define a rendering function that renders a cue to a score of Midi notes, which is the object of this chapter.</p>
<p>The <code>MidiNote</code> type is imported from <code>Music.Render.Midi</code>, but we define some extra type synonyms to make the rendering functions somewhat more readable:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">MidiChannel</span>    <span class="fu">=</span> <span class="dt">Int</span><br /><span class="kw">type</span> <span class="dt">MidiInstrument</span> <span class="fu">=</span> <span class="dt">Maybe</span> <span class="dt">Int</span><br /><span class="kw">type</span> <span class="dt">MidiPitch</span>      <span class="fu">=</span> <span class="dt">Int</span><br /><span class="kw">type</span> <span class="dt">MidiBend</span>       <span class="fu">=</span> <span class="dt">Semitones</span><br /><span class="kw">type</span> <span class="dt">MidiDynamic</span>    <span class="fu">=</span> <span class="dt">Int</span></code></pre>
<h2 id="channel"><a href="#TOC">Channel</a></h2>
<p>A caveat is that the Midi representation does not handle simultaneous tunings well. We must therefore separete the music into different Midi channels based on part, section and intontation.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">midiChannel </span><span class="ot">::</span> <span class="dt">Cue</span> <span class="ot">-&gt;</span> <span class="dt">MidiChannel</span><br />midiChannel (<span class="dt">Cue</span> part doubling dynamics technique) <span class="fu">=</span><br />    midiChannel' part section intonation'<br />    <span class="kw">where</span><br />          section     <span class="fu">=</span> partSection part<br />          intonation' <span class="fu">=</span> intonation doubling technique<br /><br />midiChannel'  ( <span class="dt">Violin</span> _)   <span class="dt">High</span>   <span class="dt">Tuning</span>      <span class="fu">=</span>  <span class="dv">0</span><br />midiChannel'  ( <span class="dt">Viola</span>  _ )  <span class="dt">High</span>   <span class="dt">Tuning</span>      <span class="fu">=</span>  <span class="dv">1</span><br />midiChannel'  ( <span class="dt">Cello</span>  _ )  <span class="dt">High</span>   <span class="dt">Tuning</span>      <span class="fu">=</span>  <span class="dv">2</span><br />midiChannel'  ( <span class="dt">Violin</span> _)   <span class="dt">Low</span>    <span class="dt">Tuning</span>      <span class="fu">=</span>  <span class="dv">3</span><br />midiChannel'  ( <span class="dt">Viola</span>  _ )  <span class="dt">Low</span>    <span class="dt">Tuning</span>      <span class="fu">=</span>  <span class="dv">4</span><br />midiChannel'  ( <span class="dt">Cello</span>  _ )  <span class="dt">Low</span>    <span class="dt">Tuning</span>      <span class="fu">=</span>  <span class="dv">5</span><br />midiChannel'  ( <span class="dt">Violin</span> _)   _      <span class="dt">Common</span>      <span class="fu">=</span>  <span class="dv">6</span><br />midiChannel'  ( <span class="dt">Viola</span>  _ )  _      <span class="dt">Common</span>      <span class="fu">=</span>  <span class="dv">7</span><br />midiChannel'  ( <span class="dt">Cello</span>  _ )  _      <span class="dt">Common</span>      <span class="fu">=</span>  <span class="dv">8</span><br /><br />midiChannel'  <span class="dt">DoubleBass</span>    _      _           <span class="fu">=</span>  <span class="dv">10</span><br /><br />midiChannel'  ( <span class="dt">Violin</span> _)   _      <span class="dt">Raised</span>      <span class="fu">=</span>  <span class="dv">11</span><br />midiChannel'  ( <span class="dt">Viola</span>  _ )  _      <span class="dt">Raised</span>      <span class="fu">=</span>  <span class="dv">11</span><br />midiChannel'  ( <span class="dt">Cello</span>  _ )  _      <span class="dt">Raised</span>      <span class="fu">=</span>  <span class="dv">13</span><br />midiChannel'  ( <span class="dt">Violin</span> _)   <span class="dt">High</span>   <span class="dt">Individual</span>  <span class="fu">=</span>  <span class="dv">0</span><br />midiChannel'  ( <span class="dt">Viola</span>  _ )  <span class="dt">High</span>   <span class="dt">Individual</span>  <span class="fu">=</span>  <span class="dv">1</span><br />midiChannel'  ( <span class="dt">Cello</span>  _ )  <span class="dt">High</span>   <span class="dt">Individual</span>  <span class="fu">=</span>  <span class="dv">2</span><br />midiChannel'  ( <span class="dt">Violin</span> _)   <span class="dt">Low</span>    <span class="dt">Individual</span>  <span class="fu">=</span>  <span class="dv">3</span><br />midiChannel'  ( <span class="dt">Viola</span>  _ )  <span class="dt">Low</span>    <span class="dt">Individual</span>  <span class="fu">=</span>  <span class="dv">4</span><br />midiChannel'  ( <span class="dt">Cello</span>  _ )  <span class="dt">Low</span>    <span class="dt">Individual</span>  <span class="fu">=</span>  <span class="dv">5</span></code></pre>
<h2 id="instrument"><a href="#TOC">Instrument</a></h2>
<p>Instrument rendering is simple: if the technique is <em>pizzicato</em>, use the pizzicato strings program, otherwise use the program representing the current instrument.</p>
<p>(The standard programs give us solo sounds. We could mix in the <em>string ensemble</em> program based on the doubling attribute. I am not sure this is a good idea though.)</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">midiInstrument </span><span class="ot">::</span> <span class="dt">Cue</span> <span class="ot">-&gt;</span> <span class="dt">MidiInstrument</span><br />midiInstrument (<span class="dt">Cue</span> part doubling dynamics technique) <span class="fu">=</span><br />    <span class="kw">case</span> technique <span class="kw">of</span><br />        (<span class="dt">Pizz</span> _ _) <span class="ot">-&gt;</span> <span class="kw">Just</span> <span class="dv">45</span><br />        _          <span class="ot">-&gt;</span> midiInstrument' part<br /><br />midiInstrument' ( <span class="dt">Violin</span> _ )  <span class="fu">=</span>  <span class="kw">Just</span> <span class="dv">40</span><br />midiInstrument' ( <span class="dt">Viola</span> _ )   <span class="fu">=</span>  <span class="kw">Just</span> <span class="dv">41</span><br />midiInstrument' ( <span class="dt">Cello</span> _ )   <span class="fu">=</span>  <span class="kw">Just</span> <span class="dv">42</span><br />midiInstrument' <span class="dt">DoubleBass</span>    <span class="fu">=</span>  <span class="kw">Just</span> <span class="dv">43</span></code></pre>
<h2 id="pitch-and-bending"><a href="#TOC">Pitch and bending</a></h2>
<p>Table of open string pitches.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">openStringPitch </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">MidiPitch</span><br />openStringPitch ( <span class="dt">Violin</span> _ ) <span class="dt">I</span>    <span class="fu">=</span>  <span class="dv">55</span><br />openStringPitch ( <span class="dt">Violin</span> _ ) <span class="dt">II</span>   <span class="fu">=</span>  <span class="dv">62</span><br />openStringPitch ( <span class="dt">Violin</span> _ ) <span class="dt">III</span>  <span class="fu">=</span>  <span class="dv">69</span><br />openStringPitch ( <span class="dt">Violin</span> _ ) <span class="dt">IV</span>   <span class="fu">=</span>  <span class="dv">76</span><br />openStringPitch ( <span class="dt">Viola</span> _ )  <span class="dt">I</span>    <span class="fu">=</span>  <span class="dv">48</span><br />openStringPitch ( <span class="dt">Viola</span> _ )  <span class="dt">II</span>   <span class="fu">=</span>  <span class="dv">55</span><br />openStringPitch ( <span class="dt">Viola</span> _ )  <span class="dt">III</span>  <span class="fu">=</span>  <span class="dv">62</span><br />openStringPitch ( <span class="dt">Viola</span> _ )  <span class="dt">IV</span>   <span class="fu">=</span>  <span class="dv">69</span><br />openStringPitch ( <span class="dt">Cello</span> _ )  <span class="dt">I</span>    <span class="fu">=</span>  <span class="dv">36</span><br />openStringPitch ( <span class="dt">Cello</span> _ )  <span class="dt">II</span>   <span class="fu">=</span>  <span class="dv">43</span><br />openStringPitch ( <span class="dt">Cello</span> _ )  <span class="dt">III</span>  <span class="fu">=</span>  <span class="dv">50</span><br />openStringPitch ( <span class="dt">Cello</span> _ )  <span class="dt">IV</span>   <span class="fu">=</span>  <span class="dv">57</span><br />openStringPitch <span class="dt">DoubleBass</span>   <span class="dt">I</span>    <span class="fu">=</span>  <span class="dv">28</span><br />openStringPitch <span class="dt">DoubleBass</span>   <span class="dt">II</span>   <span class="fu">=</span>  <span class="dv">33</span><br />openStringPitch <span class="dt">DoubleBass</span>   <span class="dt">III</span>  <span class="fu">=</span>  <span class="dv">38</span><br />openStringPitch <span class="dt">DoubleBass</span>   <span class="dt">IV</span>   <span class="fu">=</span>  <span class="dv">43</span><br /><br /><span class="ot">naturalHarmonicPitch </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">MidiPitch</span><br />naturalHarmonicPitch part str tone <span class="fu">=</span><br />    fundamental <span class="fu">+</span> overtone<br />    <span class="kw">where</span><br />        fundamental <span class="fu">=</span> openStringPitch part str<br />        overtone <span class="fu">=</span> scaleFromSteps [<span class="dv">0</span>,<span class="dv">12</span>,<span class="dv">7</span>,<span class="dv">5</span>,<span class="dv">4</span>,<span class="dv">3</span>,<span class="dv">3</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>] <span class="ot">`step`</span> tone</code></pre>
<p>We determine amount of pitch bend from the part, doubling and technique. Note that the <code>cents</code> function converts a frequency to cents, so by subtracting the reference pitch from the intonation, we get the amount of bending in cents. Then divide this by 100 to get the amount in semitones.</p>
<p>For harmonics, we add a compensation for the difference between just and twelve-tone equal temperament. Unfortunately this does not work for harmonic tremolos.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">midiBend </span><span class="ot">::</span> <span class="dt">Cue</span> <span class="ot">-&gt;</span> <span class="dt">MidiBend</span><br />midiBend (<span class="dt">Cue</span> part doubling dynamics technique) <span class="fu">=</span><br />    midiBend' (intonation', cents') <span class="fu">+</span> just<br />    <span class="kw">where</span><br />        intonation'  <span class="fu">=</span>  intonation doubling technique<br />        tuning'      <span class="fu">=</span>  partTuning part<br />        cents'       <span class="fu">=</span>  cents tuning' <span class="fu">-</span> cents <span class="dv">440</span><br />        just         <span class="fu">=</span>  midiBendJust (<span class="fu">head</span> <span class="fu">.</span> leftHand <span class="fu">$</span> technique)<br /><br />midiBend' ( <span class="dt">Raised</span>, c )      <span class="fu">=</span>  getCent (c <span class="fu">+</span> raisedIntonation) <span class="fu">/</span> <span class="dv">100</span><br />midiBend' ( <span class="dt">Tuning</span>, c )      <span class="fu">=</span>  getCent c <span class="fu">/</span> <span class="dv">100</span><br />midiBend' ( <span class="dt">Common</span>, c )      <span class="fu">=</span>  <span class="dv">0</span><br />midiBend' ( <span class="dt">Individual</span>, c )  <span class="fu">=</span>  <span class="dv">0</span><br /><br /><span class="ot">midiBendJust </span><span class="ot">::</span> <span class="dt">LeftHand</span> <span class="dt">Pitch</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">MidiBend</span><br />midiBendJust ( <span class="dt">NaturalHarmonic</span> x s )  <span class="fu">=</span>  midiBendJust' x<br />midiBendJust _                        <span class="fu">=</span> <span class="dv">0</span><br /><br />midiBendJust' <span class="dv">0</span>  <span class="fu">=</span>  <span class="dv">0</span><br />midiBendJust' <span class="dv">1</span>  <span class="fu">=</span>  <span class="dv">0</span><br />midiBendJust' <span class="dv">2</span>  <span class="fu">=</span>  <span class="dv">0</span><span class="fu">.</span><span class="dv">0196</span><br />midiBendJust' <span class="dv">3</span>  <span class="fu">=</span>  <span class="dv">0</span><br />midiBendJust' <span class="dv">4</span>  <span class="fu">=</span>  <span class="fu">-</span><span class="dv">0</span><span class="fu">.</span><span class="dv">1369</span><br />midiBendJust' <span class="dv">5</span>  <span class="fu">=</span>  <span class="dv">0</span><span class="fu">.</span><span class="dv">0196</span><br />midiBendJust' <span class="dv">6</span>  <span class="fu">=</span>  <span class="fu">-</span><span class="dv">0</span><span class="fu">.</span><span class="dv">3117</span><br />midiBendJust' <span class="dv">7</span>  <span class="fu">=</span>  <span class="dv">0</span><br />midiBendJust' <span class="dv">8</span>  <span class="fu">=</span>  <span class="dv">0</span><span class="fu">.</span><span class="dv">0391</span></code></pre>
<h2 id="left-hand"><a href="#TOC">Left hand</a></h2>
<p>The <code>renderLeftHand</code> function returns a score of duration one, possibly containing tremolos. This property is formalized by the use of a <code>TremoloScore</code>, i.e. a score containing either notes or tremolos.</p>
<p>Note: Glissandos are not supported yet.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">renderLeftHand </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">LeftHand</span> <span class="dt">Pitch</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />renderLeftHand part ( <span class="dt">OpenString</span>           s )      <span class="fu">=</span>  renderLeftHandSingle (openStringPitch part s)<br />renderLeftHand part ( <span class="dt">NaturalHarmonic</span>      x s )    <span class="fu">=</span>  renderLeftHandSingle (naturalHarmonicPitch part s x)<br />renderLeftHand part ( <span class="dt">NaturalHarmonicTrem</span>  x y s )  <span class="fu">=</span>  renderLeftHandTrem (naturalHarmonicPitch part s x) (naturalHarmonicPitch part s y)<br />renderLeftHand part ( <span class="dt">NaturalHarmonicGliss</span> x y s )  <span class="fu">=</span>  renderLeftHandGliss<br />renderLeftHand part ( <span class="dt">QuarterStoppedString</span> s )      <span class="fu">=</span>  renderLeftHandSingle (openStringPitch part s)<br />renderLeftHand part ( <span class="dt">StoppedString</span>        x s )    <span class="fu">=</span>  renderLeftHandSingle x<br />renderLeftHand part ( <span class="dt">StoppedStringTrem</span>    x y s )  <span class="fu">=</span>  renderLeftHandTrem x y<br />renderLeftHand part ( <span class="dt">StoppedStringGliss</span>   x y s )  <span class="fu">=</span>  renderLeftHandGliss<br /><br />renderLeftHandSingle x    <span class="fu">=</span>  note <span class="fu">.</span> <span class="kw">Left</span>  <span class="fu">$</span> renderMidiNote x<br />renderLeftHandTrem   x y  <span class="fu">=</span>  note <span class="fu">.</span> <span class="kw">Right</span> <span class="fu">$</span> tremoloBetween tremoloInterval (renderMidiNote x) (renderMidiNote y)<br />renderLeftHandGliss       <span class="fu">=</span>  <span class="fu">error</span> <span class="st">&quot;Gliss not implemented&quot;</span><br /><br />renderMidiNote x <span class="fu">=</span> <span class="dt">MidiNote</span> <span class="dv">0</span> <span class="kw">Nothing</span> x <span class="dv">0</span> <span class="dv">60</span><br />tremoloInterval <span class="fu">=</span> <span class="dv">0</span><span class="fu">.</span><span class="dv">08</span></code></pre>
<h2 id="right-hand"><a href="#TOC">Right hand</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">renderRightHand </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> <span class="dt">Technique</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />renderRightHand part ( <span class="dt">Pizz</span>   articulation leftHand )  <span class="fu">=</span> renderLeftHand part leftHand<br />renderRightHand part ( <span class="dt">Single</span> articulation leftHand )  <span class="fu">=</span> renderLeftHand part leftHand<br />renderRightHand part ( <span class="dt">Phrase</span> phrasing leftHand )      <span class="fu">=</span> renderLeftHands part leftHand<br />renderRightHand part ( <span class="dt">Jete</span>   phrasing leftHand )      <span class="fu">=</span> renderLeftHands part (<span class="fu">zip</span> bounceDur leftHand)<br /><br /><span class="ot">renderLeftHands </span><span class="ot">::</span> <span class="dt">Part</span> <span class="ot">-&gt;</span> [(<span class="dt">Dur</span>, <span class="dt">LeftHand</span> <span class="dt">Pitch</span> <span class="dt">Str</span>)] <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />renderLeftHands part  <span class="fu">=</span>  stretchTo <span class="dv">1</span> <span class="fu">.</span> concatSeq <span class="fu">.</span> <span class="fu">map</span> leftHands<br />    <span class="kw">where</span><br />        leftHands (d, x)  <span class="fu">=</span>  stretch d <span class="fu">$</span> renderLeftHand part x</code></pre>
<h2 id="cues-1"><a href="#TOC">Cues</a></h2>
<p>This section needs some cleanup...</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">setMidiChannel </span><span class="ot">::</span> <span class="dt">MidiChannel</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />setMidiChannel c <span class="fu">=</span> fmapE f g<br />    <span class="kw">where</span> f <span class="fu">=</span> (\(<span class="dt">MidiNote</span> _ i p b n) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b n)<br />          g <span class="fu">=</span> <span class="fu">fmap</span> (\(<span class="dt">MidiNote</span> _ i p b n) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b n)<br /><br /><span class="ot">setMidiInstrument </span><span class="ot">::</span> <span class="dt">MidiInstrument</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />setMidiInstrument i <span class="fu">=</span> fmapE f g<br />    <span class="kw">where</span> f <span class="fu">=</span> (\(<span class="dt">MidiNote</span> c _ p b n) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b n)<br />          g <span class="fu">=</span> <span class="fu">fmap</span> (\(<span class="dt">MidiNote</span> c _ p b n) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b n)<br /><br /><span class="ot">setMidiBend </span><span class="ot">::</span> <span class="dt">MidiBend</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />setMidiBend b <span class="fu">=</span> fmapE f g<br />    <span class="kw">where</span> f <span class="fu">=</span> (\(<span class="dt">MidiNote</span> c i p _ n) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b n)<br />          g <span class="fu">=</span> <span class="fu">fmap</span> (\(<span class="dt">MidiNote</span> c i p _ n) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b n)<br /><br /><span class="ot">setMidiDynamic </span><span class="ot">::</span> <span class="dt">Dynamics</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />setMidiDynamic (<span class="dt">Dynamics</span> n) <span class="fu">=</span> tmapE f g<br />    <span class="kw">where</span> f <span class="fu">=</span> (\t (<span class="dt">MidiNote</span> c i p b _) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b (<span class="fu">round</span> <span class="fu">$</span> n t <span class="fu">*</span> <span class="dv">63</span> <span class="fu">+</span> <span class="dv">63</span>))<br />          g <span class="fu">=</span> (\t x <span class="ot">-&gt;</span> tmap (\t (<span class="dt">MidiNote</span> c i p b _) <span class="ot">-&gt;</span> <span class="dt">MidiNote</span> c i p b (<span class="fu">round</span> <span class="fu">$</span> n t <span class="fu">*</span> <span class="dv">63</span> <span class="fu">+</span> <span class="dv">63</span>)) x)</code></pre>
<p>Some constants used for the rendering of jeté strokes.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">bounceDur </span><span class="ot">::</span> [<span class="dt">Dur</span>]<br />bounceDur  <span class="fu">=</span>  [ (<span class="dv">2</span> <span class="fu">**</span> (<span class="fu">-</span><span class="dv">0</span><span class="fu">.</span><span class="dv">9</span> <span class="fu">*</span> x)) <span class="fu">/</span> <span class="dv">6</span> <span class="fu">|</span> x <span class="ot">&lt;-</span> [<span class="dv">0</span>, <span class="dv">0</span><span class="fu">.</span><span class="dv">1</span><span class="fu">..</span><span class="dv">1</span><span class="fu">.</span><span class="dv">2</span>] ]<br /><br /><span class="ot">bounceVel </span><span class="ot">::</span> [<span class="dt">Double</span>]<br />bounceVel  <span class="fu">=</span>  [ <span class="fu">abs</span> (<span class="dv">1</span> <span class="fu">-</span> x) <span class="fu">|</span> x <span class="ot">&lt;-</span> [<span class="dv">0</span>, <span class="dv">0</span><span class="fu">.</span><span class="dv">08</span><span class="fu">..</span>]]</code></pre>
<p>Render each cue to a score of <code>MidiNote</code> elements. Each generated score has a duration of one, so this function can be used with <code>&gt;&gt;=</code> to render a score of cues to Midi (see below.)</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">renderCue </span><span class="ot">::</span> <span class="dt">Cue</span> <span class="ot">-&gt;</span> <span class="dt">TremoloScore</span> <span class="dt">Dur</span> <span class="dt">MidiNote</span><br />renderCue cue <span class="fu">=</span><br />    renderRest <span class="fu">$</span> renderRightHand (cuePart cue) (cueTechnique cue)<br />    <span class="kw">where</span><br />        channel     <span class="fu">=</span>  midiChannel cue<br />        instr       <span class="fu">=</span>  midiInstrument cue<br />        bend        <span class="fu">=</span>  midiBend cue<br /><br />        renderRest  <span class="fu">=</span>  setMidiChannel channel<br />                    <span class="fu">.</span>  setMidiInstrument instr<br />                    <span class="fu">.</span>  setMidiBend bend<br />                    <span class="fu">.</span>  setMidiDynamic (cueDynamics cue)</code></pre>
<p>This instance makes it possible to use the <code>play</code> function on scores of cues:</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">instance</span> <span class="dt">Render</span> (<span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span>) <span class="dt">Midi</span> <span class="kw">where</span><br />    render  <span class="fu">=</span>  render<br />            <span class="fu">.</span>  restAfter <span class="dv">5</span><br />            <span class="fu">.</span>  renderTremoloEvents<br />            <span class="fu">.</span>  (<span class="fu">&gt;&gt;=</span> renderCue)</code></pre>
<p></p>
<h1 id="high-level-constructors"><a href="#TOC">High-level constructors</a></h1>
<p>Allthough the <em>cues</em> defined in the previous chapters is a flexible representation for an orchestral piece, they are somewhat cubersome to construct. This is easily solved by adding some higher-level constructors.</p>
<p>The constructors all create <em>standard cues</em> with the following definitions:</p>
<pre class="sourceCode"><code class="sourceCode haskell">standardCue           <span class="fu">=</span>  note <span class="fu">.</span> <span class="dt">Cue</span> (<span class="dt">Violin</span> <span class="dv">1</span>) <span class="dt">Tutti</span> mf<br />standardArticulation  <span class="fu">=</span>  <span class="dt">Straight</span><br />standardPhrasing      <span class="fu">=</span>  <span class="dt">Phrasing</span></code></pre>
<p>These can be overriden using the methods of the type classes <code>Temporal</code>, <code>Timed</code>, <code>Delayed</code>, <code>PartFunctor</code>, <code>PitchFunctor</code> and <code>LevelFunctor</code> respectively.</p>
<h2 id="open-strings"><a href="#TOC">Open Strings</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">openString </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />openString x <span class="fu">=</span> standardCue<br />    <span class="fu">$</span> <span class="dt">Single</span> standardArticulation<br />    <span class="fu">$</span> <span class="dt">OpenString</span> x<br /><br /><span class="ot">openStringPizz </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />openStringPizz x <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Pizz</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">OpenString</span> x<br /><br /><span class="ot">openStringJete </span><span class="ot">::</span> [<span class="dt">Str</span>] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />openStringJete xs <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Jete</span> standardPhrasing<br />     <span class="fu">$</span> <span class="fu">map</span> <span class="dt">OpenString</span> xs<br /><br /><span class="ot">openStrings </span><span class="ot">::</span> [(<span class="dt">Dur</span>, <span class="dt">Str</span>)] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />openStrings xs <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Phrase</span> standardPhrasing<br />     <span class="fu">$</span> <span class="fu">map</span> (\(d,x) <span class="ot">-&gt;</span> (d, <span class="dt">OpenString</span> x)) xs</code></pre>
<h2 id="natural-harmonics"><a href="#TOC">Natural harmonics</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">naturalHarmonic </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />naturalHarmonic s x <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Single</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">NaturalHarmonic</span> x s<br /><br /><span class="ot">naturalHarmonicPizz </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />naturalHarmonicPizz s x <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Pizz</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">NaturalHarmonic</span> x s<br /><br /><span class="ot">naturalHarmonicJete </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> [<span class="dt">Pitch</span>] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />naturalHarmonicJete s xs <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Jete</span> standardPhrasing<br />     <span class="fu">$</span> <span class="fu">map</span> (\x <span class="ot">-&gt;</span> <span class="dt">NaturalHarmonic</span> x s) xs<br /><br /><span class="ot">naturalHarmonics </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> [(<span class="dt">Dur</span>, <span class="dt">Pitch</span>)] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />naturalHarmonics s xs <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Phrase</span> standardPhrasing<br />     <span class="fu">$</span> <span class="fu">map</span> (\(d,x) <span class="ot">-&gt;</span> (d, <span class="dt">NaturalHarmonic</span> x s)) xs</code></pre>
<h2 id="quarter-stopped-strings"><a href="#TOC">Quarter stopped strings</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">quarterStoppedString </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />quarterStoppedString x <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Single</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">QuarterStoppedString</span> x<br /><br /><span class="ot">quarterStoppedStrings </span><span class="ot">::</span> [(<span class="dt">Dur</span>, <span class="dt">Str</span>)] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />quarterStoppedStrings xs <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Phrase</span> standardPhrasing<br />     <span class="fu">$</span> <span class="fu">map</span> (\(d,x) <span class="ot">-&gt;</span> (d, <span class="dt">QuarterStoppedString</span> x)) xs</code></pre>
<h2 id="stopped-strings"><a href="#TOC">Stopped strings</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">stoppedString </span><span class="ot">::</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />stoppedString x <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Single</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">StoppedString</span> x <span class="dt">I</span><br /><br /><span class="ot">stoppedStringPizz </span><span class="ot">::</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />stoppedStringPizz x <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Pizz</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">StoppedString</span> x <span class="dt">I</span><br /><br /><span class="ot">stoppedStringJete </span><span class="ot">::</span> [<span class="dt">Pitch</span>] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />stoppedStringJete xs <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Jete</span> standardPhrasing<br />     <span class="fu">$</span> <span class="fu">map</span> (\x <span class="ot">-&gt;</span> <span class="dt">StoppedString</span> x <span class="dt">I</span>) xs<br /><br /><span class="ot">stoppedStrings </span><span class="ot">::</span> [(<span class="dt">Dur</span>, <span class="dt">Pitch</span>)] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />stoppedStrings xs <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Phrase</span> standardPhrasing<br />     <span class="fu">$</span> <span class="fu">map</span> (\(d,x) <span class="ot">-&gt;</span> (d, <span class="dt">StoppedString</span> x <span class="dt">I</span>)) xs</code></pre>
<h2 id="tremolo"><a href="#TOC">Tremolo</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">stoppedStringTrem </span><span class="ot">::</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />stoppedStringTrem x y <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Single</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">StoppedStringTrem</span> x y <span class="dt">I</span><br /><br /><span class="ot">naturalHarmonicTrem </span><span class="ot">::</span> <span class="dt">Str</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />naturalHarmonicTrem s x y <span class="fu">=</span> standardCue<br />     <span class="fu">$</span> <span class="dt">Single</span> standardArticulation<br />     <span class="fu">$</span> <span class="dt">NaturalHarmonicTrem</span> x y s</code></pre>
<p></p>
<h1 id="final-composition"><a href="#TOC">Final composition</a></h1>
<p>In this chapter we will assemble the final piece.</p>
<h2 id="pitches"><a href="#TOC">Pitches</a></h2>
<p>The pitch material is based on a 15-tone symmetric scale. The lower half is mixolydian and the upper half is aeolian (i.e. the inverse of mixolydian).</p>
<p>We will represent melodies in a relative fashion, using 0 to represent a reference pitch. This simplifies inversion and similar techniques. We use A3 as the reference pitch (corresponding to step 0). The <code>tonality</code> function applies the major-minor scale at the reference pitch, so pitch operations applied <em>before</em> this function is diatonic, while operations applied <em>after</em> it is chromatic.</p>
<pre class="sourceCode"><code class="sourceCode haskell">minScale    <span class="fu">=</span> scaleFromSteps [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>]<br />majMinScale <span class="fu">=</span> <span class="dt">Scale</span> <span class="fu">$</span> getScale lower <span class="fu">++</span> getScale upper<br />    <span class="kw">where</span><br />        lower <span class="fu">=</span> retrograde <span class="fu">.</span> invert <span class="fu">$</span> minScale<br />        upper <span class="fu">=</span> <span class="dt">Scale</span> <span class="fu">.</span> <span class="fu">tail</span> <span class="fu">.</span> getScale <span class="fu">$</span> minScale<br /><br /><span class="ot">tonality </span><span class="ot">::</span> <span class="dt">PitchFunctor</span> f <span class="ot">=&gt;</span> f <span class="ot">-&gt;</span> f<br />tonality <span class="fu">=</span> mapPitch <span class="fu">$</span> offset <span class="fu">.</span> scale <span class="fu">.</span> tonic<br />    <span class="kw">where</span><br />        tonic  <span class="fu">=</span> (<span class="fu">+</span> <span class="dv">7</span>)<br />        scale  <span class="fu">=</span> (majMinScale <span class="ot">`step`</span>)<br />        offset <span class="fu">=</span> (<span class="fu">+</span> <span class="dv">57</span>)</code></pre>
<p>The <code>tonalSeq</code> function generates a binary musical sequence, in which the second operand is transposed the given amount of steps. The <code>tonalConcat</code> function is the same on higher arities.</p>
<p>The <code>fifthUp</code>, <code>fifthDown</code> etc are handy shortcuts for transposition.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">tonalSeq </span><span class="ot">::</span> (<span class="dt">Time</span> t, <span class="dt">PitchFunctor</span> a) <span class="ot">=&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> t a <span class="ot">-&gt;</span> <span class="dt">Score</span> t a <span class="ot">-&gt;</span> <span class="dt">Score</span> t a<br /><span class="ot">tonalConcat </span><span class="ot">::</span> (<span class="dt">Time</span> t, <span class="dt">PitchFunctor</span> a) <span class="ot">=&gt;</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> [<span class="dt">Score</span> t a] <span class="ot">-&gt;</span> <span class="dt">Score</span> t a<br /><br />tonalSeq    p x y  <span class="fu">=</span>  x <span class="fu">&gt;&gt;&gt;</span> mapPitch (<span class="fu">+</span> p) y<br />tonalConcat p      <span class="fu">=</span>  List.foldr (tonalSeq p) instant<br /><br />duodecDown, octaveDown,<span class="ot"> fifthDown </span><span class="ot">::</span> <span class="dt">PitchFunctor</span> a <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> a<br />fifthUp, octaveUp,<span class="ot"> duodecUp       </span><span class="ot">::</span> <span class="dt">PitchFunctor</span> a <span class="ot">=&gt;</span> a <span class="ot">-&gt;</span> a<br /><br />duodecDown  <span class="fu">=</span>  mapPitch (<span class="fu">+</span> (<span class="fu">-</span><span class="dv">19</span>))<br />octaveDown  <span class="fu">=</span>  mapPitch (<span class="fu">+</span> (<span class="fu">-</span><span class="dv">12</span>))<br />fifthDown   <span class="fu">=</span>  mapPitch (<span class="fu">+</span> (<span class="fu">-</span><span class="dv">7</span>))<br />fifthUp     <span class="fu">=</span>  mapPitch (<span class="fu">+</span> <span class="dv">7</span>)<br />octaveUp    <span class="fu">=</span>  mapPitch (<span class="fu">+</span> <span class="dv">12</span>)<br />duodecUp    <span class="fu">=</span>  mapPitch (<span class="fu">+</span> <span class="dv">19</span>)</code></pre>
<h2 id="melody"><a href="#TOC">Melody</a></h2>
<p>Melodic patterns that may work well in the symmetric scale.</p>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="kw">type</span> <span class="dt">Pattern</span> <span class="fu">=</span>  [(<span class="dt">Dur</span>, <span class="dt">Pitch</span>)]<br /><br /><span class="ot">pattern </span><span class="ot">::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Pattern</span><br />pattern <span class="fu">=</span> (patterns <span class="fu">!!</span>)<br /><br /><span class="co">-- Play using</span><br /><span class="co">--     play . tonality . patternMelody $ pattern 0</span><br />patterns <span class="fu">=</span><br />    [<br />        <span class="fu">zip</span> [ <span class="dv">3</span>, <span class="dv">3</span> ]<br />            [ <span class="dv">0</span>, <span class="dv">1</span> ],<br />        <span class="fu">zip</span> [ <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span> ]<br />            [ <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="dv">1</span> ],<br />        <span class="fu">zip</span> [ <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span> ]<br />            [ <span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">0</span>, <span class="dv">1</span> ],<br />        <span class="fu">zip</span> [] [],<br />        <span class="fu">zip</span> [] [],<br /><br />        <span class="co">-- 5</span><br />        <span class="fu">zip</span> [ <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">3</span> ]<br />            [ <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">0</span>, <span class="fu">-</span><span class="dv">1</span> ],<br />        <span class="fu">zip</span> [ <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">4</span> ]<br />            [ <span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span> ]<br />    ]<br /><br /><span class="ot">patternMelody </span><span class="ot">::</span> <span class="dt">Pattern</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />patternMelody x <span class="fu">=</span> stretch (scaling x <span class="fu">/</span> <span class="dv">2</span>) <span class="fu">.</span> stoppedStrings <span class="fu">$</span> x<br />    <span class="kw">where</span><br />        scaling <span class="fu">=</span> <span class="fu">sum</span> <span class="fu">.</span> <span class="fu">map</span> <span class="fu">fst</span><br /><br /><span class="ot">patternSequence </span><span class="ot">::</span> <span class="dt">Pitch</span> <span class="ot">-&gt;</span> [<span class="dt">Pattern</span>] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />patternSequence p <span class="fu">=</span> tonalConcat p <span class="fu">.</span> <span class="fu">map</span> patternMelody</code></pre>
<h2 id="harmony"><a href="#TOC">Harmony</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">secondChord </span><span class="ot">::</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> [<span class="dt">Str</span>] <span class="ot">-&gt;</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />secondChord xs ss ps <span class="fu">=</span>  instant<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Cello</span>  (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonic (ss <span class="fu">!!</span> <span class="dv">0</span>) (ps <span class="fu">!!</span> <span class="dv">0</span>))<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Viola</span>  (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonic (ss <span class="fu">!!</span> <span class="dv">1</span>) (ps <span class="fu">!!</span> <span class="dv">1</span>))<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Violin</span> (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonic (ss <span class="fu">!!</span> <span class="dv">2</span>) (ps <span class="fu">!!</span> <span class="dv">2</span>))<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Violin</span> (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonic (ss <span class="fu">!!</span> <span class="dv">3</span>) (ps <span class="fu">!!</span> <span class="dv">3</span>))<br /><br /><span class="ot">secondChordTrem </span><span class="ot">::</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> [<span class="dt">Str</span>] <span class="ot">-&gt;</span> [<span class="dt">Int</span>] <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />secondChordTrem xs ss ps <span class="fu">=</span>  instant<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Cello</span>  (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonicTrem (ss <span class="fu">!!</span> <span class="dv">0</span>) <span class="dv">0</span> (ps <span class="fu">!!</span> <span class="dv">0</span>))<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Viola</span>  (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonicTrem (ss <span class="fu">!!</span> <span class="dv">1</span>) <span class="dv">0</span> (ps <span class="fu">!!</span> <span class="dv">1</span>))<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Violin</span> (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonicTrem (ss <span class="fu">!!</span> <span class="dv">2</span>) <span class="dv">0</span> (ps <span class="fu">!!</span> <span class="dv">2</span>))<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Violin</span> (xs <span class="fu">!!</span> <span class="dv">0</span>)) <span class="fu">$</span> naturalHarmonicTrem (ss <span class="fu">!!</span> <span class="dv">3</span>) <span class="dv">0</span> (ps <span class="fu">!!</span> <span class="dv">3</span>))<br /><br /><br />scs <span class="fu">=</span> concatSeq <span class="fu">$</span>&#160;do <br />    ss <span class="ot">&lt;-</span> <span class="fu">return</span> [<span class="dt">IV</span>,<span class="dt">III</span>,<span class="dt">II</span>,<span class="dt">I</span>]<br />    ps <span class="ot">&lt;-</span> List.permutations [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">3</span>,<span class="dv">4</span>]<br />    <span class="co">-- xs &lt;- List.permutations [2,1,2,1]</span><br />    <span class="co">-- return $ secondChord xs ss ps</span><br />    <span class="fu">return</span> <span class="fu">$</span> secondChord [<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>] ss ps <span class="fu">|||</span> secondChord [<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">2</span>] ss ps<br /><br /><span class="co">-- g, a, d, e</span><br /><span class="co">-- scs = concatSeq $&#160;do </span><br /><span class="co">--     ss &lt;- return [IV,III,II,I]</span><br /><span class="co">--     xs &lt;- List.permutations [2,1,2,1]</span><br /><span class="co">--     ps &lt;- List.permutations [1,2,2,3]</span><br /><span class="co">--     return $ secondChord xs ss ps</span><br /><br /><span class="co">-- g, a, d, e</span><br /><span class="co">-- scs = concatSeq $&#160;do </span><br /><span class="co">--     xs &lt;- return [1,1,1,1]</span><br /><span class="co">--     ss &lt;- return [IV,III,II,I]</span><br /><span class="co">--     ps &lt;- List.permutations [1,1,1,2]</span><br /><span class="co">--     return $ secondChord xs ss ps</span><br /><br /><br /><br /><br /><br /><br /><br />ch  <span class="fu">=</span>  instant<br /><span class="co">--    ||| (setDynamics p . setPart DoubleBass  $ naturalHarmonic I 4)</span><br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">2</span>)   <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">2</span>)<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Viola</span> <span class="dv">2</span>)   <span class="fu">$</span> naturalHarmonic <span class="dt">III</span> <span class="dv">1</span>)<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">II</span> <span class="dv">3</span>)<br />    <span class="fu">|||</span> (setDynamics p <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">1</span>)<br /><br /><br /><br />a  <span class="fu">=</span>  instant<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart <span class="dt">DoubleBass</span>  <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">4</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>)   <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">3</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Viola</span> <span class="dv">1</span>)   <span class="fu">$</span> naturalHarmonic <span class="dt">III</span> <span class="dv">2</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">1</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">II</span>  <span class="dv">1</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">II</span>  <span class="dv">1</span>)<br /><br />b  <span class="fu">=</span>  instant<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart <span class="dt">DoubleBass</span>  <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">4</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">2</span>)   <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">3</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Viola</span> <span class="dv">2</span>)   <span class="fu">$</span> naturalHarmonic <span class="dt">III</span> <span class="dv">2</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">II</span>  <span class="dv">1</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">1</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">II</span>  <span class="dv">1</span>)<br /><br />d  <span class="fu">=</span>  instant<br />    <span class="fu">|||</span> (setDynamics pp <span class="fu">.</span> setPart <span class="dt">DoubleBass</span> <span class="fu">$</span> naturalHarmonic <span class="dt">I</span> <span class="dv">3</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">II</span> <span class="dv">2</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">III</span> <span class="dv">3</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Viola</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">III</span> <span class="dv">1</span>)<br />    <span class="fu">|||</span> (setDynamics ppp <span class="fu">.</span> setPart (<span class="dt">Viola</span> <span class="dv">2</span>)  <span class="fu">$</span> naturalHarmonic <span class="dt">II</span> <span class="dv">2</span>)<br /><br />mm <span class="fu">=</span> instant<br />    <span class="fu">|||</span> (setDynamics pp <span class="fu">.</span> delay <span class="dv">0</span>   <span class="fu">.</span> stretch <span class="dv">2</span> <span class="fu">.</span> mapPitch (<span class="fu">+</span> <span class="dv">7</span>) <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">0</span>,<span class="dv">0</span>])<br />nn <span class="fu">=</span> instant<br />    <span class="fu">|||</span> (setDynamics pp <span class="fu">.</span> delay <span class="dv">0</span>   <span class="fu">.</span> stretch <span class="dv">2</span> <span class="fu">.</span> mapPitch (<span class="fu">+</span> <span class="dv">7</span>) <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>) <span class="fu">.</span> invert <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">0</span>,<span class="dv">0</span>])<br /><br />m <span class="fu">=</span> instant<br />    <span class="fu">|||</span> (setDynamics pp <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">0</span> <span class="fu">.</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> mapPitch (<span class="fu">+</span> <span class="dv">0</span>) <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics pp <span class="fu">.</span> delay <span class="dv">1</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">2</span> <span class="fu">.</span> mapPitch (<span class="fu">+</span> <span class="dv">0</span>) <span class="fu">.</span> tonality <span class="fu">.</span> invert <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>])<br /><br />n <span class="fu">=</span> instant<br />    <span class="fu">|||</span> (setDynamics pp <span class="fu">.</span> delay <span class="dv">5</span>   <span class="fu">.</span> stretch <span class="dv">5</span> <span class="fu">.</span> mapPitch (<span class="fu">+</span> <span class="dv">7</span>) <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">5</span>,<span class="dv">1</span>])<br />    <span class="fu">|||</span> (setDynamics pp <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">0</span> <span class="fu">.</span> stretch <span class="dv">4</span> <span class="fu">.</span> mapPitch (<span class="fu">+</span> <span class="dv">0</span>) <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">5</span>])</code></pre>
<h2 id="sections"><a href="#TOC">Sections</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><br /><span class="ot">introHarm </span><span class="ot">::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />introHarm sect <span class="fu">=</span> stretch <span class="dv">1</span> <span class="fu">$</span> instant<br />    <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">3</span> a <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">2</span> g <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">3</span><span class="fu">.</span><span class="dv">4</span> a <span class="fu">&gt;&gt;&gt;</span> introHarm sect<br />    <span class="kw">where</span> a  <span class="fu">=</span> setPart (<span class="dt">Cello</span> sect) <span class="fu">.</span> setDynamics ppp <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">1</span><br />          g  <span class="fu">=</span> setPart (<span class="dt">Viola</span> sect) <span class="fu">.</span> setDynamics ppp <span class="fu">$</span> naturalHarmonic <span class="dt">II</span> <span class="dv">1</span><br /><br /><span class="ot">introHarmTrem </span><span class="ot">::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />introHarmTrem sect <span class="fu">=</span> stretch <span class="dv">2</span> <span class="fu">$</span> instant<br />    <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">3</span> a <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">4</span> g<br />    <span class="kw">where</span> a  <span class="fu">=</span> setPart (<span class="dt">Cello</span> sect) <span class="fu">.</span> setDynamics ppp <span class="fu">$</span> naturalHarmonicTrem <span class="dt">IV</span> <span class="dv">0</span> <span class="dv">1</span><br />          g  <span class="fu">=</span> setPart (<span class="dt">Viola</span> sect) <span class="fu">.</span> setDynamics ppp <span class="fu">$</span> naturalHarmonicTrem <span class="dt">II</span> <span class="dv">0</span> <span class="dv">1</span><br /><br /><span class="ot">introHarmVln </span><span class="ot">::</span> <span class="dt">Int</span> <span class="ot">-&gt;</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />introHarmVln sect <span class="fu">=</span> stretch <span class="dv">1</span> <span class="fu">$</span> instant<br />    <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">3</span> d <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">2</span> d2 <span class="fu">&gt;&gt;&gt;</span> stretch <span class="dv">3</span><span class="fu">.</span><span class="dv">4</span> a <span class="fu">&gt;&gt;&gt;</span> introHarm sect<br />    <span class="kw">where</span> d  <span class="fu">=</span> setPart (<span class="dt">Violin</span> sect) <span class="fu">.</span> setDynamics ppp <span class="fu">$</span> naturalHarmonic <span class="dt">I</span>  <span class="dv">2</span><br />          d2 <span class="fu">=</span> setPart (<span class="dt">Violin</span> sect) <span class="fu">.</span> setDynamics ppp <span class="fu">$</span> naturalHarmonic <span class="dt">II</span> <span class="dv">1</span><br />          a  <span class="fu">=</span> setPart (<span class="dt">Violin</span> sect) <span class="fu">.</span> setDynamics ppp <span class="fu">$</span> naturalHarmonic <span class="dt">III</span> <span class="dv">1</span><br /><br />intro2 <span class="fu">=</span> instant<br />    <span class="fu">|||</span> (before <span class="dv">30</span> <span class="fu">$</span> introHarm <span class="dv">1</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">15</span>  <span class="fu">.</span> before <span class="dv">30</span> <span class="fu">$</span> introHarm <span class="dv">2</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">25</span>  <span class="fu">.</span> stretch <span class="dv">5</span> <span class="fu">$</span> db)<br />    <span class="fu">|||</span> (delay <span class="dv">35</span>  <span class="fu">.</span> before <span class="dv">35</span> <span class="fu">$</span> introHarm <span class="dv">1</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">50</span>  <span class="fu">.</span> before <span class="dv">35</span> <span class="fu">$</span> introHarm <span class="dv">2</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">60</span>  <span class="fu">.</span> stretch <span class="dv">5</span> <span class="fu">$</span> db2)<br />    <span class="fu">|||</span> (delay <span class="dv">80</span>  <span class="fu">.</span> before <span class="dv">15</span> <span class="fu">$</span> introHarmTrem <span class="dv">1</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">90</span>  <span class="fu">.</span> before <span class="dv">30</span> <span class="fu">$</span> introHarm <span class="dv">2</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">100</span> <span class="fu">.</span> stretch <span class="dv">5</span> <span class="fu">$</span> db)<br />    <span class="fu">|||</span> (delay <span class="dv">110</span> <span class="fu">.</span> before <span class="dv">30</span> <span class="fu">$</span> introHarm <span class="dv">1</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">125</span> <span class="fu">.</span> before <span class="dv">15</span> <span class="fu">$</span> introHarmTrem <span class="dv">2</span>)<br /><br />    <span class="fu">|||</span> (delay <span class="dv">75</span> <span class="fu">.</span> before <span class="dv">25</span> <span class="fu">$</span> introHarmVln <span class="dv">1</span>)<br />    <span class="fu">|||</span> (delay <span class="dv">95</span> <span class="fu">.</span> before <span class="dv">30</span> <span class="fu">$</span> introHarmVln <span class="dv">1</span>)<br /><br />    <span class="kw">where</span><br />        db  <span class="fu">=</span> setPart <span class="dt">DoubleBass</span> <span class="fu">.</span> setDynamics ppp <span class="fu">.</span> stretch <span class="dv">4</span>  <span class="fu">$</span> naturalHarmonic <span class="dt">III</span> <span class="dv">4</span><br />        db2 <span class="fu">=</span> setPart <span class="dt">DoubleBass</span> <span class="fu">.</span> setDynamics ppp <span class="fu">.</span> stretch <span class="dv">4</span>  <span class="fu">$</span> naturalHarmonic <span class="dt">IV</span> <span class="dv">4</span><br /><br /><br /><span class="co">-- TODO redo completely</span><br />intro <span class="fu">=</span> instant<br />    <span class="fu">|||</span> (before <span class="dv">40</span> <span class="fu">.</span> stretch <span class="dv">4</span> <span class="fu">.</span> loopOverlayAll <span class="fu">$</span> [a, b]) <br />    <span class="fu">|||</span> rest <span class="dv">5</span> <span class="fu">&gt;&gt;&gt;</span> mm <span class="fu">&gt;&gt;&gt;</span> rest <span class="dv">5</span> <span class="fu">&gt;&gt;&gt;</span> nn<br /><br /><br /><span class="co">-- TODO expand</span><br />middle <span class="fu">=</span> instant<br />    <span class="fu">|||</span> stretch <span class="dv">10</span> d <br />    <span class="fu">|||</span> (setPart (<span class="dt">Cello</span>  <span class="dv">1</span>) <span class="fu">.</span> setDynamics p <span class="fu">.</span> octaveDown <span class="fu">.</span> tonality <span class="fu">.</span> patternMelody) (pattern <span class="dv">2</span>)<br /><br /><br /><br /><br /><br />middle2 <span class="fu">=</span> compress <span class="dv">1</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> <span class="fu">reverse</span> <span class="fu">$</span> instant<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> <span class="co">{-delay 0.3 . -}</span>stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> octaveUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> <span class="co">{-delay 0.2 . -}</span>stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">2</span> <span class="fu">.</span> octaveUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> <span class="co">{-delay 0.1 . -}</span>stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">5</span> <span class="fu">.</span> fifthUp  <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">3</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> <span class="co">{-delay 0.4 . -}</span>stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">9</span> <span class="fu">.</span> fifthUp  <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">4</span>) <span class="fu">$</span> patternSequence <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> <span class="co">{-delay 0.6 . -}</span>stretch <span class="dv">3</span><span class="fu">.</span><span class="dv">5</span> <span class="fu">.</span> <span class="fu">id</span>       <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>) <span class="fu">$</span> patternSequence  <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>])<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> <span class="co">{-delay 0.5 . -}</span>stretch <span class="dv">4</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> <span class="fu">id</span>       <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Viola</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence   <span class="dv">0</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br /><br />middle2b <span class="fu">=</span> middle2 <span class="fu">&gt;&gt;&gt;</span> (before <span class="dv">40</span> <span class="fu">.</span> stretch <span class="dv">0</span><span class="fu">.</span><span class="dv">6</span> <span class="fu">.</span> <span class="fu">reverse</span> <span class="fu">$</span> middle2)<br /><br />end <span class="fu">=</span> compress <span class="dv">1</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">$</span> instant<br />    <span class="fu">|||</span> (setDynamics f <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">3</span> <span class="fu">.</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> duodecUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence <span class="dv">1</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">0</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics f <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">2</span> <span class="fu">.</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">2</span> <span class="fu">.</span> duodecUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>) <span class="fu">$</span> patternSequence <span class="dv">1</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics f <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">5</span> <span class="fu">.</span> octaveUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">3</span>) <span class="fu">$</span> patternSequence <span class="dv">1</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">0</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics f <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">4</span> <span class="fu">.</span> stretch <span class="dv">2</span><span class="fu">.</span><span class="dv">9</span> <span class="fu">.</span> octaveUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">4</span>) <span class="fu">$</span> patternSequence <span class="dv">1</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics f <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">6</span> <span class="fu">.</span> stretch <span class="dv">3</span><span class="fu">.</span><span class="dv">5</span> <span class="fu">.</span> fifthUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Violin</span> <span class="dv">2</span>) <span class="fu">$</span> patternSequence  <span class="dv">1</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">0</span>])<br />    <span class="fu">|||</span> (setDynamics f <span class="fu">.</span> delay <span class="dv">0</span><span class="fu">.</span><span class="dv">5</span> <span class="fu">.</span> stretch <span class="dv">4</span><span class="fu">.</span><span class="dv">1</span> <span class="fu">.</span> fifthUp <span class="fu">.</span> tonality <span class="fu">.</span> setPart (<span class="dt">Viola</span> <span class="dv">1</span>) <span class="fu">$</span> patternSequence   <span class="dv">1</span> <span class="fu">.</span> <span class="fu">map</span> pattern <span class="fu">$</span> [<span class="dv">1</span>,<span class="dv">2</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">2</span>])<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> concatSeq <span class="fu">$</span> <span class="fu">map</span> (\x <span class="ot">-&gt;</span> stretch <span class="dv">20</span> <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>)  <span class="fu">$</span> stoppedString x) [<span class="dv">57</span>,<span class="dv">56</span><span class="fu">..</span><span class="dv">52</span>])<br />    <span class="fu">|||</span> (setDynamics mf <span class="fu">.</span> concatSeq <span class="fu">$</span> <span class="fu">map</span> (\x <span class="ot">-&gt;</span> stretch <span class="dv">30</span> <span class="fu">.</span> setPart (<span class="dt">Cello</span> <span class="dv">1</span>)  <span class="fu">$</span> stoppedString x) [<span class="dv">54</span>,<span class="dv">52</span><span class="fu">..</span><span class="dv">52</span>])<br />    <span class="fu">|||</span>&#160;(setDynamics mf <span class="fu">.</span> stretch <span class="dv">80</span> <span class="fu">.</span> setPart <span class="dt">DoubleBass</span> <span class="fu">$</span> openString <span class="dt">IV</span>)<br /><br />test <span class="fu">=</span> intro2 <span class="fu">&gt;&gt;&gt;</span> middle <span class="fu">&gt;&gt;&gt;</span> middle2b <span class="fu">&gt;&gt;&gt;</span> end<br /><br /><span class="co">-- TODO coda?</span></code></pre>
<h2 id="test"><a href="#TOC">Test</a></h2>
<pre class="sourceCode"><code class="sourceCode haskell"><span class="ot">test </span><span class="ot">::</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br /><span class="co">--test = instant</span><br /><br /><span class="ot">allHarmonics </span><span class="ot">::</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />allHarmonics <span class="fu">=</span> stretch (<span class="dv">1</span><span class="fu">/</span><span class="dv">3</span>) <span class="fu">$</span> instant<br />    <span class="fu">&gt;&gt;&gt;</span> concatSeq [ setPart <span class="dt">DoubleBass</span> <span class="fu">$</span> naturalHarmonic str pos <span class="fu">|</span> str <span class="ot">&lt;-</span> <span class="fu">enumFrom</span> <span class="dt">I</span>, pos <span class="ot">&lt;-</span> [<span class="dv">0</span><span class="fu">..</span><span class="dv">7</span>] ]<br /><br /><br /><span class="ot">allOpenStrings </span><span class="ot">::</span> <span class="dt">Score</span> <span class="dt">Dur</span> <span class="dt">Cue</span><br />allOpenStrings <span class="fu">=</span> stretch (<span class="dv">1</span><span class="fu">/</span><span class="dv">3</span>) <span class="fu">$</span> instant<br />    <span class="fu">&gt;&gt;&gt;</span> concatSeq [ setPart <span class="dt">DoubleBass</span>   <span class="fu">$</span> openString str <span class="fu">|</span> str <span class="ot">&lt;-</span> <span class="fu">enumFrom</span> <span class="dt">I</span> ]<br />    <span class="fu">&gt;&gt;&gt;</span> concatSeq [ setPart (instr part) <span class="fu">$</span> openString str <span class="fu">|</span> instr <span class="ot">&lt;-</span> [<span class="dt">Cello</span>, <span class="dt">Viola</span>, <span class="dt">Violin</span>]<br />                                                          , part  <span class="ot">&lt;-</span> [<span class="dv">2</span>,<span class="dv">1</span>]<br />                                                          , str   <span class="ot">&lt;-</span> <span class="fu">enumFrom</span> <span class="dt">I</span> ]<br /><br />main <span class="fu">=</span> writeMidi <span class="st">&quot;Passager.mid&quot;</span> (render test)</code></pre>
</body>
</html>
